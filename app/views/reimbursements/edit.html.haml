.page-header
  %h1=t '.title', :default => [:'helpers.titles.edit', 'Edit %{model}'], :model => Reimbursement.model_name.human

%strong.label= Reimbursement.human_attribute_name(:event)
%br
= render resource.event

%strong.label= Reimbursement.human_attribute_name(:request)
%br
= render parent

%strong.label= t(:general_info)
%br
= simple_form_for resource, :url => request_reimbursement_path(parent), :method => :put do |f|
  .form-inputs.form-horizontal
    = f.input :description, :input_html => {:rows => 3}
    = f.input :requester_notes, :input_html => {:rows => 3}
  .form-inputs.form-inline
    %strong.label= Reimbursement.human_attribute_name(:expenses)
    - if !resource.errors[:"request.expenses"].empty?
      .error= resource.expenses.map {|e| e.errors.full_messages}.uniq.join("; ")
    %table.table.table-condensed
      %thead
        %tr
          %th= Reimbursement.human_attribute_name(:subject)
          %th= Reimbursement.human_attribute_name(:description)
          %th= Reimbursement.human_attribute_name(:estimated_amount)
          %th= Reimbursement.human_attribute_name(:approved_amount)
          %th= Reimbursement.human_attribute_name(:total_amount)
          %th
      %tbody#expenses
        = f.simple_fields_for :request do |request|
          = request.simple_fields_for :expenses do |e|
            - expense = e.object
            %tr
              %td= expense.subject
              %td= expense.description
              %td= number_to_currency(expense.estimated_amount, :unit => expense.estimated_currency)
              %td= number_to_currency(expense.approved_amount, :unit => expense.approved_currency)
              %td= number_to_currency(e.text_field(:total_amount, :class => 'input-mini'), :unit => expense.approved_currency)
              %td

  .form-actions
    = f.button :submit, :class => 'btn-primary'
    = link_to t('.cancel', :default => t("helpers.links.cancel")), parent_path, :class => 'btn'
