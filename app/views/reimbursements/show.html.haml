- model_class = Reimbursement
.page-header
  %h1=t '.title', :default => model_class.model_name.human

= show_for resource do |r|
  = r.association :event do
    = render resource.event
  = r.association :user do
    = render resource.user
  = r.attribute :request do
    = render parent
  = r.attribute :state do
    = timestamped_state(resource)
    = link_to t(:show_history), "\#history", :data => {:toggle => :collapse}
    %blockquote#history.collapse
      .row-fluid
        .span6
          = r.attribute :incomplete_since
          = r.attribute :tsp_pending_since
          = r.attribute :tsp_approved_since
          = r.attribute :payment_pending_since
        .span6
          = r.attribute :payed_since
          = r.attribute :completed_since
          = r.attribute :canceled_since

  = r.attribute :description
  = r.attribute :requester_notes
  = r.attribute :tsp_notes

  %strong.label= Request.human_attribute_name(:expenses)
  %table.table.table-condensed
    %thead
      %tr
        %th= RequestExpense.human_attribute_name(:subject)
        %th= RequestExpense.human_attribute_name(:description)
        %th= RequestExpense.human_attribute_name(:estimated_amount)
        %th= RequestExpense.human_attribute_name(:approved_amount)
        %th= RequestExpense.human_attribute_name(:total_amount)
        %th= RequestExpense.human_attribute_name(:authorized_amount)
    %tbody#expenses
      - @request.expenses.each do |expense|
        %tr
          %td= expense.subject
          %td= expense.description
          %td= number_to_currency(expense.estimated_amount, :unit => expense.estimated_currency)
          %td= number_to_currency(expense.approved_amount, :unit => expense.approved_currency)
          %td= number_to_currency(expense.total_amount, :unit => expense.total_currency)
          %td= number_to_currency(expense.authorized_amount, :unit => expense.authorized_currency)

.form-actions

  - if can? :edit, resource
    = link_to t('.edit', :default => t("helpers.links.edit")), edit_resource_path, :class => 'btn'

  - if can? :submit, resource
    = link_to t("activerecord.state_machines.events.submit"), request_reimbursement_submission_path(parent), :method => :post, :data => { :confirm => t("helpers.links.confirm") }, :class => 'btn btn-success'

  - if can? :approve, resource
    = link_to t("activerecord.state_machines.events.approve"), new_request_reimbursement_approval_path(parent), :class => 'btn btn-success'

